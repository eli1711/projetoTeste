<!DOCTYPE html>
<html lang="pt-BR"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Responder Avaliação</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-slate-100 to-red-100 min-h-screen flex flex-col font-sans">

<header class="bg-red-700 text-white shadow">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center gap-4">
    <a href="/home" class="font-semibold tracking-tight text-lg flex items-center gap-3">
      <span class="inline-flex items-center justify-center h-9 w-9 rounded-md bg-red-800 text-xs font-bold">
        CPA
      </span>
      <div class="flex flex-col leading-tight">
        <span class="text-sm uppercase tracking-[0.2em] text-red-100">Sistema CPA</span>
        <span class="text-base">Avaliação</span>
      </div>
    </a>

    <form th:action="@{/logout}" method="post" class="inline" sec:authorize="isAuthenticated()">
      <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
      <button type="submit"
              class="px-3 py-1.5 rounded-full bg-red-900 hover:bg-red-800 text-[11px] font-semibold shadow-sm transition">
        Sair
      </button>
    </form>
  </div>
</header>

<main class="flex-1">
  <div class="max-w-4xl mx-auto px-4 py-10">

    <div class="bg-white rounded-2xl shadow border border-red-100 p-8">

      <div class="mb-6 text-center">
        <div class="inline-flex items-center gap-2 rounded-full bg-red-50 text-red-700 px-3 py-1 mb-3">
          <span class="inline-block h-2 w-2 rounded-full bg-red-600"></span>
          <span class="text-[11px] font-semibold tracking-wide uppercase">
            Responder Avaliação
          </span>
        </div>

        <h1 class="text-2xl font-bold text-slate-900 tracking-tight"
            th:text="${questionnaire.name}">
          Nome do questionário
        </h1>

        <p class="text-sm text-slate-500 mt-2">
          Responda a importância e a satisfação para cada questão quantitativa.
        </p>
      </div>

      <div th:if="${error}"
           class="mb-4 text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-4 py-2">
        <span th:text="${error}">Erro</span>
      </div>

      <div th:if="${success}"
           class="mb-4 text-sm text-green-700 bg-green-50 border border-green-200 rounded-lg px-4 py-2">
        <span th:text="${success}">Ok</span>
      </div>

      <form th:action="@{/avaliacoes/{id}/responder(id=${avaliacao.id})}" method="post" class="space-y-7">
        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>

        <div th:each="q, idx : ${questions}" class="border border-slate-200 rounded-xl p-5 bg-slate-50">
          <div class="flex items-start justify-between gap-4">
            <div>
              <p class="text-xs text-slate-500 font-semibold">
                Questão <span th:text="${idx.index + 1}">1</span>
                <span class="ml-2 inline-flex items-center rounded-full bg-white border border-slate-200 px-2 py-0.5 text-[10px] text-slate-600"
                      th:text="${q.itemAvaliacao != null ? q.itemAvaliacao.name() : 'SEM_ITEM'}">ITEM</span>
              </p>
              <h2 class="text-base font-semibold text-slate-900 mt-1" th:text="${q.text}">
                Texto da questão
              </h2>
            </div>

            <span th:if="${q.type.name() == 'QUANTITATIVA'}"
                  class="shrink-0 inline-flex items-center rounded-full bg-red-100 text-red-700 px-2.5 py-1 text-[11px] font-semibold">
              Quantitativa
            </span>
            <span th:if="${q.type.name() == 'QUALITATIVA'}"
                  class="shrink-0 inline-flex items-center rounded-full bg-blue-100 text-blue-700 px-2.5 py-1 text-[11px] font-semibold">
              Qualitativa
            </span>
          </div>

          <!-- QUANTITATIVA: IMPORTÂNCIA + SATISFAÇÃO -->
          <div th:if="${q.type.name() == 'QUANTITATIVA'}" class="mt-5 space-y-5">

            <!-- IMPORTÂNCIA -->
            <div class="bg-white border border-slate-200 rounded-xl p-4">
              <p class="text-sm font-semibold text-slate-700 mb-3">IMPORTÂNCIA</p>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">

                <label class="flex items-center gap-2 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer">
                  <input type="radio"
                         th:name="'importanciaQuestao[' + ${q.id} + ']'"
                         value="BAIXA"
                         required>
                  <span class="text-sm text-slate-700">Baixa</span>
                </label>

                <label class="flex items-center gap-2 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer">
                  <input type="radio"
                         th:name="'importanciaQuestao[' + ${q.id} + ']'"
                         value="MEDIA"
                         required>
                  <span class="text-sm text-slate-700">Média</span>
                </label>

                <label class="flex items-center gap-2 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer">
                  <input type="radio"
                         th:name="'importanciaQuestao[' + ${q.id} + ']'"
                         value="ALTA"
                         required>
                  <span class="text-sm text-slate-700">Alta</span>
                </label>

              </div>
            </div>

            <!-- SATISFAÇÃO -->
            <div class="bg-white border border-slate-200 rounded-xl p-4">
              <p class="text-sm font-semibold text-slate-700 mb-3">SATISFAÇÃO</p>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">

                <label class="flex items-center gap-2 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer">
                  <input type="radio"
                         th:name="'responses[' + ${q.id} + ']'"
                         value="1"
                         required>
                  <span class="text-sm text-slate-700"
                        th:text="${q.option1Label != null ? q.option1Label : 'Discordo totalmente'}">Discordo totalmente</span>
                </label>

                <label class="flex items-center gap-2 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer">
                  <input type="radio"
                         th:name="'responses[' + ${q.id} + ']'"
                         value="2"
                         required>
                  <span class="text-sm text-slate-700"
                        th:text="${q.option2Label != null ? q.option2Label : 'Discordo parcialmente'}">Discordo parcialmente</span>
                </label>

                <label class="flex items-center gap-2 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer">
                  <input type="radio"
                         th:name="'responses[' + ${q.id} + ']'"
                         value="3"
                         required>
                  <span class="text-sm text-slate-700"
                        th:text="${q.option3Label != null ? q.option3Label : 'Concordo parcialmente'}">Concordo parcialmente</span>
                </label>

                <label class="flex items-center gap-2 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer">
                  <input type="radio"
                         th:name="'responses[' + ${q.id} + ']'"
                         value="4"
                         required>
                  <span class="text-sm text-slate-700"
                        th:text="${q.option4Label != null ? q.option4Label : 'Concordo totalmente'}">Concordo totalmente</span>
                </label>

              </div>

              <!-- 5ª opção opcional -> value 0 -->
              <div class="mt-3" th:if="${q.option5Label != null and !#strings.isEmpty(q.option5Label)}">
                <label class="flex items-center gap-2 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer">
                  <input type="radio"
                         th:name="'responses[' + ${q.id} + ']'"
                         value="0"
                         required>
                  <span class="text-sm text-slate-700" th:text="${q.option5Label}">Não sei opinar</span>
                </label>
                <p class="text-[11px] text-slate-400 mt-1">
                  Opção extra (vale 0%).
                </p>
              </div>

            </div>
          </div>

          <!-- QUALITATIVA -->
          <div th:if="${q.type.name() == 'QUALITATIVA'}" class="mt-5">
            <label class="block text-sm font-semibold text-slate-700 mb-2">Resposta</label>
            <textarea rows="4"
                      th:name="'responses[' + ${q.id} + ']'"
                      class="w-full px-4 py-3 border border-slate-300 rounded-lg text-sm
                             focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition bg-white"
                      placeholder="Digite sua resposta..."></textarea>
          </div>

        </div>

        <div class="pt-2 flex justify-center gap-3">
          <a href="/home"
             class="px-5 py-2 rounded-lg border border-slate-300 text-slate-700 text-sm font-medium hover:bg-slate-100 transition">
            Cancelar
          </a>
          <button type="submit"
                  class="bg-red-700 text-white px-6 py-2.5 rounded-lg font-medium shadow-sm
                         hover:bg-red-800 focus:ring-2 focus:ring-red-500 focus:outline-none transition text-sm">
            Enviar Respostas
          </button>
        </div>

      </form>

    </div>

  </div>
</main>

<footer class="border-t border-slate-200 bg-white">
  <div class="max-w-6xl mx-auto px-4 py-4 text-center text-xs text-slate-500">
    © 2025 Sistema de Avaliação CPA
  </div>
</footer>

</body>
</html>
